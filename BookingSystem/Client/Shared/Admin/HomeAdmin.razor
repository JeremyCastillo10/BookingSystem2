@page "/Admin"
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Components.Authorization;
@using System.Security.Claims;
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager;

<AuthorizeView>
<Authorized>
        @if (_userId == "32de09be-fe8a-4223-a986-e27428935a50")
            {
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h1 class="text-center">Welcome Admin</h1>
                        <a class="btn btn-info" href="ModalServicio">Services</a>
                        <a class="btn btn-info" href="ModalProfesional">Profesionals</a>
                    </div>
                </div>
                <h3>@userRole</h3>
            </div>
            }
            else
            {
                <p>No Authorizado</p>
            }
           
      
    </Authorized>
    <NotAuthorized>
        <p>No Auth</p>
    </NotAuthorized>
</AuthorizeView>

@code{
    private IEnumerable<Claim> _claims = Enumerable.Empty<Claim>();
    private string _authMessage;
    private string _userId;
    private string _roleName;
    public string userRole = null;
    protected override async Task OnInitializedAsync()
    {
        await GetClaimsPrincipalData();


    }
    private async Task GetClaimsPrincipalData()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        var role = authState.User.IsInRole("Admin");
        if (user.Identity.IsAuthenticated)
        {
            _authMessage = $"{user.Identity.Name} is authenticated.";
            _claims = user.Claims;
            _userId = $"{user.FindFirst(c => c.Type == "sub")?.Value}";
            if (authState.User.IsInRole("Admin"))
            {
                userRole = "Admin";
            }
        }
        else
        {
            _authMessage = "The user is NOT authenticated.";
        }
    }
}

